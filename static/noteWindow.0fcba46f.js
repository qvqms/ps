import{r as e,c as t,C as l,J as a,a as s,b as n,d as i,B as o,h as d,j as u,a6 as c,n as r,a7 as v,i as x,v as f,a8 as p,a9 as h,F as m,f as g,D as w,L as k,U as y,V as b,s as _,g as C,t as j,aa as S,k as L,T as M,x as D,e as I}from"./index.adfd1ee8.js";const K={class:"nodeWindow flex"},T={class:"left"},W={class:"titleTop flex pl-5 items-center"},Y=i("span",{class:"text-2xl"},"备忘录",-1),U={class:"saveText text-lg"},V=i("svg",{width:"24",height:"24",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M24.0605 10L24.0239 38",stroke:"#fff","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"}),i("path",{d:"M10 24L38 24",stroke:"#fff","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"})],-1),z={class:"titleScroll"},B=["onClick"],H={class:"font-bold text-ellipsis whitespace-nowrap overflow-hidden h-5"},E={class:"text-xs mt-1"},F={class:"delicon"},J={key:0,class:"right flex items-center justify-center"},O=["src"],q={key:1,class:"right"},A={class:"flex mt-1.5"},G=i("span",{class:"text-xs text-gray-400"},"编辑完成请按Ctrl+S快捷保存，Mac用户请按Command+S快捷保存",-1),N={__name:"noteWindow",setup(N){const P=e(!0),Q=e({text:"",title:""}),R=e(t.get("noteSort","desc")),X=()=>{"desc"==R.value?R.value="aes":R.value="desc",t.set("noteSort",R.value),se()},Z=e=>{P.value=!1},$=e([]),ee=e=>{le({},!0,(function(){Q.value=e,e.id&&y({url:"/note/getText",params:{id:e.id}}).then((e=>{Q.value.text=e.data.text}))}))},te=()=>{let e=[];$.value.forEach((t=>{e.length<4&&e.push(Object.assign({},t))})),I.emit("noteLoading",e)},le=(e,t=!1,l)=>{const{key:a=!1,ctrlKey:s=!1,metaKey:n=!1}=e;if("s"===a&&(1==s||1==n)||t){if(t||e.preventDefault(),P.value)return void(l&&l());""==Q.value.text&&""==Q.value.title||(""==Q.value.title&&(Q.value.title=Q.value.text.slice(0,49)),y({url:"/note/add",method:"post",data:{...Q.value}}).then((e=>{1==e.code?(Q.value.id=parseInt(e.data),P.value=!0,te(),l()):b.error(e.msg)})))}},ae=()=>{if(_.state.isLogin){let e={id:"",title:"",text:""};$.value.unshift(e),ee($.value[0])}else b.warning("此功能需要登录才可以用呢")},se=()=>{y({url:"/note/get",method:"get",params:{sort:R.value}}).then((e=>{$.value=e.data,$.value.length>0&&ee($.value[0])}))};return l((()=>{0==P.value&&le({},!0)})),se(),(e,t)=>{const l=a("el-icon"),b=a("el-button");return s(),n("div",K,[i("div",T,[i("div",W,[Y,i("div",{class:"flex flex-col -space-y-1 ml-3",onClick:X},[o(l,{class:r("aes"==R.value?"text-blue-400":"")},{default:d((()=>[o(u(c))])),_:1},8,["class"]),o(l,{class:r("desc"==R.value?"text-blue-400":"")},{default:d((()=>[o(u(v))])),_:1},8,["class"])]),i("div",U,[x(i("span",null,[o(l,{class:"text-blue-400",title:"已保存同步"},{default:d((()=>[o(u(p))])),_:1})],512),[[f,P.value]]),x(i("span",null,[o(l,{class:"text-orange-400",title:"未保存"},{default:d((()=>[o(u(h))])),_:1})],512),[[f,!P.value]])]),i("div",{class:"addicon",onClick:ae},[o(l,{size:"30px",title:"添加记事"},{default:d((()=>[V])),_:1})])]),i("div",z,[(s(!0),n(m,null,g($.value,((e,t)=>(s(),C(M,{key:e.id},{default:d((()=>{return[i("div",{class:r(["nodeWindow-list text-black hover:text-blue-500 hover:bg-white",{"nodeWindow-listSelect":e==Q.value}]),onClick:t=>ee(e)},[i("div",H,j(e.title||"无标题"),1),i("div",E,j((t=e.update_time,D(t).format("YYYY/MM/DD HH:mm"))),1),i("div",F,[o(l,{onClick:L((t=>(e=>{const t=$.value.findIndex((t=>t.id==e.id));t>-1&&($.value.splice(t,1),e.id&&y({url:"/note/del",params:{id:e.id}})),t>0?ee($.value[t-1]):$.value.length>0?ee($.value[0]):Q.value={id:"",title:"",text:""},te()})(e)),["stop"]),title:"删除"},{default:d((()=>[o(u(S))])),_:2},1032,["onClick"])])],10,B)];var t})),_:2},1024)))),128))])]),0==$.value.length?(s(),n("div",J,[i("img",{src:u("/web/static/empty.0f3e50d7.svg"),class:"w-2/3 h-2/3 opacity-80"},null,8,O)])):(s(),n("div",q,[x(i("input",{placeholder:"请输入标题","onUpdate:modelValue":t[0]||(t[0]=e=>Q.value.title=e),maxlength:"50",onKeydown:t[1]||(t[1]=e=>le(e)),onInput:Z,class:"text-lg font-bold w-full outline-none border-none placeholder-gray-400"},null,544),[[w,Q.value.title]]),x(i("textarea",{placeholder:"从这里开始书写您的记录吧",class:"w-full placeholder-gray-400",onKeydown:t[2]||(t[2]=e=>le(e)),maxlength:"4999","onUpdate:modelValue":t[3]||(t[3]=e=>Q.value.text=e),onInput:Z},null,544),[[w,Q.value.text]]),i("div",A,[G,o(b,{size:"small",class:"ml-auto -mt-1.5",onClick:t[4]||(t[4]=e=>le(e,!0)),type:"primary"},{default:d((()=>[k("保存")])),_:1})])]))])}}};export{N as default};
